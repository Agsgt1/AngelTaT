<script src="../habitat-embed.js"></script>
<script>
	Habitat.registerEverything()

	const stage = new Stage()
	const scene = new Entity({
		components: [new Component.Stage(stage)],
		tick(context) {
			const { canvas } = context
			context.clearRect(0, 0, canvas.width, canvas.height)
		},
	})

	const mouse = getMouse()

	const addBox = (entity) => {
		const box = new Entity({
			components: [new Component.Transform(), new Component.Stage()],
			tick(context) {
				const [x, y] = this.transform.absolutePosition
				context.fillStyle = BLUE
				context.fillRect(x, y, 20, 20)
			},
			update() {
				this.transform.position = mouse.position
			},
		})

		entity.add(box)
		return box
	}

	const holder = new Entity({
		components: [new Component.Transform(), new Component.Stage()],
	})

	let box = addBox(holder)
	holder.transform.position = [0, 0]
	for (const i of range(0, 10)) {
		box = addBox(box)
	}
	scene.add(holder)
</script>
